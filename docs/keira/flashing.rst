.. _keira-flashing:

Запуск
======

Лілка постачається з готовою прошивкою Keira, яка вміє багато різних речей. Ця прошивка використовується для :ref:`демонстрації можливостей Лілки, а також як приклад для розробки власних програм <keira-firmware-features>`.

В цьому розділі ми розглянемо, як завантажити операційну систему Keira в Лілку.

Клонування репозиторію та побудова прошивки
-------------------------------------------

1. Перейдіть на вкладку **Source Control** (``Ctrl`` + ``Shift`` + ``G``) та клонуйте репозиторій `Lilka <https://github.com/and3rson/lilka>`_:

   .. image:: ./images/08_clone_repo_cropped.png
       :width: 80%

   Для цього натисніть "**Clone Repository**" та введіть адресу репозиторію:

   ``https://github.com/and3rson/lilka``

   .. image:: ./images/09_clone_cropped.png
       :width: 80%

2. Після клонування репозиторію перейдіть на вкладку **PlatformIO** та імпортуйте проєкт прошивки Keira для Лілки. Для цього натисніть "**Open Project**" та виберіть директорію ``lilka/firmware/keira``.

   .. image:: ./images/11_open_pio_project_cropped.png
       :width: 80%

3. Тепер нам потрібно дочекатися налаштування середовища розробки.

   **PlatformIO** автоматично встановить необхідні залежності, такі як компілятори, бібліотеки та інші інструменти, що необхідні для написання програм для Лілки.

   .. image:: ./images/13_wait_pio_project_init_more_cropped.png
       :width: 80%

4. Після налаштування середовища розробки перейдіть на вкладку **PlatformIO** та виберіть ``v2`` в якості цільової платформи. Потім натисніть "**Build**".

   .. image:: ./images/14_pio_build_v2_cropped.png
       :width: 80%

   Тепер потрібно дочекатися завершення збірки. Перша збірка може зайняти деякий час.

   .. image:: ./images/15_pio_build_v2_progress_cropped.png
       :width: 80%

   Щойно збірка завершиться, ви побачите повідомлення про успішне завершення збірки:

   .. image:: ./images/16_pio_build_ok_cropped.png
       :width: 80%

Завантаження прошивки в Лілку
-----------------------------

1. Підключіть Лілку до комп'ютера за допомогою USB-кабеля та увімкніть її.

   Windows може вимагати встановлення драйверів для Лілки. Якщо вам буде запропоновано встановити драйвери, встановіть їх.

   Після цього вимкніть Лілку.

   Тепер вам потрібно натиснути та утримувати кнопку ``SELECT`` і увімкнути Лілку. Після цього можна відпустити кнопку ``SELECT``.
   Це переведе Лілку в **режим завантаження** (**bootloader mode**): в цьому режимі ви можете завантажити в неї нову прошику.

2. Тепер перейдіть на вкладку **PlatformIO** та виберіть ``v2`` в якості цільової платформи. Потім натисніть "**Upload**".

   Спершу **PlatformIO** виконає підготовчі дії, а потім розпочне завантаження нашої свіжозібраної прошивки в Лілку.

   .. image:: ./images/17_run_upload_v2_cropped.png
       :width: 80%

   Початок завантаження виглядатиме ось так:

   .. image:: ./images/18_upload_progress_cropped.png
       :width: 80%

   Тепер потрібно дочекатися завершення завантаження. Щойно завантаження завершиться, ви побачите повідомлення про успішне завершення завантаження:

   TODO: додати скріншот, оскільки я це все робив під віртуалкою без Лілки під рукою. :)

3. Коли завантаження завершиться, натисніть кнопку ``RESET`` на Лілці та насолоджуйтесь новою прошивкою!

   .. tip::

        **Тепер вам не потрібно щоразу вручну переводити Лілку в режим завантаження, щоб завантажити нову прошивку!**

        Крім прошивки Keira, ви щойно завантажили в Лілку ще й програму-завантажувач (bootloader). Тепер ви можете завантажувати нові прошивки в Лілку безпосередньо з **PlatformIO**.

        Просто натисніть кнопку ``Upload`` в **PlatformIO** та вона автоматично переведе Лілку в режим завантаження та завантажить нову прошивку!

Вітаємо!
--------

Вітаємо, ви успішно налаштували середовище розробки та завантажили Keira в Лілку!

Ви можете потицяти Лілку та переконатися, що вона працює і спробувати різні демо. Також ви можете перейти на вкладку **Explorer** (``Ctrl`` + ``Shift`` + ``E``), відкрити файл ``src/main.cpp`` та поглянути, як виглядає код прошивки, яку ми щойно зібрали і запустили на Лілці.

Також ви можете запускати готові прошивки прямо з SD-карти, а також писати власні програми на Lua та запускати їх з SD-карти. Детальніше - в наступній частині документації: :doc:`features`.

**Лілка - це відкрита платформа**, тому ви можете змінювати код прошивки, додавати нові функції та вдосконалювати Лілку, або навіть створювати власні прошивки для неї. **Але перш ніж приступати до цього**, рекомендуємо ознайомитися з документацією бібліотеки ``lilka``, яка спрощує роботу з Лілкою, за :doc:`цим посиланням </library/index>`.
